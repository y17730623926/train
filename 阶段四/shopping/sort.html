<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./js/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index_style.css">
    <script src="../js/cookie.js"></script>
    <title>åˆ†ç±»</title>
</head>
<body>
    <div class="header_box">
        <div class="bx">
            <div class="header">
                <div class="header_ss">
                    <input type="text" placeholder="è¯·è¾“å…¥æ‚¨è¦æœç´¢çš„å•†å“" class="search_txt">
                    <span id="search">ğŸ”</span>
                </div>
                <span>æ‚¨å¥½,æ¬¢è¿å…‰ä¸´å‡¡å®¢è¯šå“ï¼</span>
                <p class="header_login">
                    <a href="./login.html" id="login">ç™»å½•</a>
                    <span>|</span>
                    <a href="./sign.html" id="sign">æ³¨å†Œ</a>
                    <a href="javascript:;">æˆ‘çš„è®¢å•</a>
                    <a href="javascript:;">ç½‘ç«™å…¬å‘Š</a>
                </p>
            </div>
        </div>
    </div>
    <div class="bx">
        <!-- äºŒçº§å¯¼èˆª -->
        <div class="nav">
            <ul class="nav_ul">
                <li>
                    <a href="index.html">é¦–é¡µ</a>
                </li>
                <li class="nav_ul_item">
                    <a></a>
                </li>
                <li>
                    <a href="javascript:;">æ›´å¤š</a>
                </li>
            </ul>
        </div>
        <!-- å†…å®¹ -->
        <div class="xiazhuang container-fluid">
            <div class="xiazhuang_warp row">
                <a class="huodong_item on .col-lg-3 .col-md-4 .col-sm-6">
                    <img alt="">
                    <p class="name"></p><span></span>
                </a>
            </div>
        </div>
        <!-- åˆ†é¡µ -->
        <div class="pageNav">
            <ul>
                <li class="cur"></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
        </div>
        <!-- é¡µè„š -->
        <div class="footer">
            <p>Copyright 2007 - 2020 vancl.com All Rights Reserved äº¬ICPè¯100557å·
                äº¬å…¬ç½‘å®‰å¤‡11011502002400å·å‡ºç‰ˆç‰©ç»è¥è®¸å¯è¯æ–°å‡ºå‘äº¬æ‰¹å­—ç¬¬ç›´110138å·</p>
        </div>
    </div>
    <script>
        (function () {
            var item_li = $(".nav_ul_item");
            //è·å–æ˜¯å¦ç™»å½•
            var cookie = new Cookie();
            var token = cookie.getCookie("token");
            var maxPage;
            var pageNum = +window.location.hash.substring(1);

            if (!window.location.hash.substring(1)) {
                pageNum = 1;
            }
            if (token) {
                $("#login").text("ç”¨æˆ·å");
                $("#sign").text("é€€å‡ºç™»å½•").attr("href", "./login.html");
            }
            //æœç´¢
            $("#search").click(function () {
                if ($(".search_txt").val()) {
                    window.location.href = "./sort.html?aa=" + $(".search_txt").val();
                } else {
                    window.location.href = "./sort.html?aa=æ›´å¤š";
                }
            });
            //è·å–æ•°æ®
            var huodong_item = $(".huodong_item").eq(0);
            var info_val = decodeURI(location.search.split("=")[1]);
            qingQiu(info_val, $(".xiazhuang_warp"), pageNum);
            //äºŒçº§å¯¼èˆª
            $.ajax({
                url: "http://localhost/w/website/findGoodsTypeList",
                type: "get",
                dataType: "json",
                data: {},
                success: function (data) {
                    console.log(data);
                    data.data.forEach(function (item, index) {
                        var con = item_li.clone(true);
                        con.removeAttr("class").find("a").attr("href", "./sort.html?aa=" + item.name).text(item["name"]);
                        $(".nav_ul > li").eq($(".nav_ul > li").length - 1).before(con);clickPaging();
                    });
                }
            })
            // è¯·æ±‚
            function qingQiu(info_val, warp, pageNum) {
                var huodong_item = $(".huodong_item").eq(0);
                $.ajax({
                    url: "http://localhost/w/website/findGoodsList",
                    dataType: "json",
                    type: "GET",
                    data: {
                        info: info_val,
                        pageNo: pageNum,
                    },
                    success: function (data) {
                        console.log(data);
                        $(".xiazhuang_warp").html("");
                        var arr = data["data"]["tbk_dg_material_optional_response"]["result_list"]["map_data"];
                        maxPage = Math.floor(data["data"]["tbk_dg_material_optional_response"].total_results / 20);
                        maxPage = maxPage > 5000 ? 5000 : maxPage;
                        clickPaging();
                        console.log(arr);
                        arr.forEach(function (item, index) {
                            var con = huodong_item.clone(true).attr("href", `./list.html?aa=${item.item_id}`);
                            con.attr("class", "huodong_item").find("img").attr("src", item["pict_url"]);
                            con.find("p").text(item["category_name"]).append("<span class='right'>" + item["zk_final_price"] + "å…ƒ</span>");
                            if (item["coupon_info"]) {
                                con.append(`<a href="${item["coupon_share_url"]}">${item["coupon_info"]}</a>`);
                            } else {
                                con.find("span").eq(1).text("æš‚æ— ä¼˜æƒ åŠµ");
                            }
                            warp.append(con);
                        });
                    }
                })
            }
            //åˆ†é¡µ
            //ç›‘å¬
            function bindEvent() {
                $(".pageNav li").click(function (event) {
                    if ($(this).html() == "â€¦") {
                        return;
                    }
                    //æ”¹å˜ä¿¡å·é‡
                    pageNum = parseInt($(this).html());
                    //è°ƒç”¨ajaxï¼Œåˆ‡æ¢åˆ†é¡µæŒ‰é’®æ ·å¼
                    
                    qingQiu(info_val, $(".xiazhuang_warp"), pageNum);
                    clickPaging();
                    //æ›´æ–°URLçš„hash
                    window.location.hash = pageNum;
                });
            }
            //ä¿¡å·é‡
            function clickPaging() {
                //æ ¹æ®ä¸åŒæƒ…å†µæœ‰ä¸åŒçš„7å°æ ¼çš„åºå·ç¼–æ’ï¼ˆçœ‹ç¬”è®°ï¼‰ï¼š
                if (pageNum >= 1 && pageNum <= 3) {
                    // console.log($("pageNav li"))
                    $(".pageNav li").eq(0).html("1");
                    $(".pageNav li").eq(1).html("2");
                    $(".pageNav li").eq(2).html("3");
                    $(".pageNav li").eq(3).html("4");
                    $(".pageNav li").eq(4).html("â€¦");
                    $(".pageNav li").eq(5).html(maxPage - 1);
                    $(".pageNav li").eq(6).html(maxPage);
                    $(".pageNav li").eq(pageNum - 1).addClass("cur").siblings().removeClass("cur");
                } else if (pageNum <= maxPage && pageNum >= maxPage - 2) {
                    $(".pageNav li").eq(0).html("1");
                    $(".pageNav li").eq(1).html("2");
                    $(".pageNav li").eq(2).html("â€¦");
                    $(".pageNav li").eq(3).html(maxPage - 3);
                    $(".pageNav li").eq(4).html(maxPage - 2);
                    $(".pageNav li").eq(5).html(maxPage - 1);
                    $(".pageNav li").eq(6).html(maxPage);
                    //cur
                    $(".pageNav li").eq(pageNum - maxPage - 1).addClass("cur").siblings().removeClass("cur");
                } else {
                    $(".pageNav li").eq(0).html("1");
                    $(".pageNav li").eq(1).html("â€¦");
                    $(".pageNav li").eq(2).html(pageNum - 1);
                    $(".pageNav li").eq(3).html(pageNum);
                    $(".pageNav li").eq(4).html(pageNum + 1);
                    $(".pageNav li").eq(5).html("â€¦");
                    $(".pageNav li").eq(6).html(maxPage);
                    //cur
                    $(".pageNav li").eq(3).addClass("cur").siblings().removeClass("cur");
                }
            }
            bindEvent();
        })();
    </script>
</body>

</html>