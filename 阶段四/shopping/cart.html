<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>è´­ç‰©è½¦</title>
    <script src="./js/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index_style.css">
    <script src="../js/cookie.js"></script>
</head>

<body>
    <div class="header_box">
        <div class="bx">
            <div class="header">
                <div class="header_ss">
                    <input type="text" placeholder="è¯·è¾“å…¥æ‚¨è¦æœç´¢çš„å•†å“" class="search_txt">
                    <span id="search">ğŸ”</span>
                </div>
                <span>æ‚¨å¥½,æ¬¢è¿å…‰ä¸´å‡¡å®¢è¯šå“ï¼</span>
                <p class="header_login">
                    <a href="./login.html" id="login">ç™»å½•</a>
                    <span>|</span>
                    <a href="./sign.html" id="sign">æ³¨å†Œ</a>
                    <a href="javascript:;">æˆ‘çš„è®¢å•</a>
                    <a href="javascript:;">ç½‘ç«™å…¬å‘Š</a>
                </p>
            </div>
        </div>
    </div>
    <div class="bx">
        <!-- äºŒçº§å¯¼èˆª -->
        <div class="nav">
            <ul class="nav_ul">
                <li>
                    <a href="index.html">é¦–é¡µ</a>
                </li>
                <li class="nav_ul_item">
                    <a></a>
                </li>
                <li>
                    <a href="javascript:;">æ›´å¤š</a>
                </li>
            </ul>
        </div>
        <div class="cart_box">
            <p class="cart_head">
                <span class="on">1.æˆ‘çš„è´­ç‰©è½¦</span>
                <span>2.å¡«å†™æ ¸å¯¹ä¿¡æ¯å•</span>
                <span>3.æˆåŠŸæäº¤è®¢å•</span>
            </p>
            <div class="cart_conent">
                <h2>æˆ‘çš„è´­ç‰©è½¦</h2>
                <p class="tishi">
                    <span>æ¸©é¦¨æç¤ºï¼š</span>1.é€‰è´­æ¸…å•ä¸­çš„å•†å“æ— æ³•ä¿ç•™åº“å­˜ï¼Œè¯·æ‚¨åŠæ—¶ç»“ç®—ã€‚2.å•†å“çš„ä»·æ ¼å’Œåº“å­˜å°†ä»¥è®¢å•æäº¤æ—¶ä¸ºå‡†ã€‚3.ä¿ƒé”€æ´»åŠ¨æ»¡å‡ä¼˜æƒ å°†å‡æ‘Šè‡³å•†å“å°è®¡ä¸­ã€‚
                </p>
                <table class="cart_table table table-hover" id="table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="quanxuan">å…¨é€‰</th>
                            <th>å•†å“åç§°</th>
                            <th>å•ä»·</th>
                            <th>æ•°é‡</th>
                            <th>å°è®¡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                    </tbody>
                </table>
                <!-- æ€»è®¡ -->
                <div class="agg">
                    <p>æ€»è®¡ï¼š<span>0</span>å…ƒ<button class="right">ç«‹å³æ”¯ä»˜</button></p>
                </div>
                <!-- å†…å®¹ -->
                <script>
                    (function () {
                        //æ·»åŠ æ•°æ®
                        var JSON_obj = JSON.parse(localStorage.getItem("array"));
                        JSON_obj.forEach(function (item, index) {
                            console.log(item);
                            $("#tbody").append(`
                                    <tr>
                                        <td class="sx">${item.num}<input type="checkbox"></td>
                                        <td><img src="${item.img}" alt=""><a href="./list.html?aa=${item.item_id}">${item.title}</a></td>
                                        <td class="unit">${item.unit}å…ƒ</td>
                                        <td>
                                            <a href="javascript:;" class="a jian">-</a>
                                            <a href="javascript:;" class="a number">${item.number}</a>
                                            <a href="javascript:;" class="a jia">+</a>
                                        </td>
                                        <td class="subtotal">${item.number * item.unit}å…ƒ</td>
                                        <td>
                                            <a href="javascript:;" id="del">åˆ é™¤</a>
                                        </td>
                                    </tr>
                                `);
                        });
                        // åŠ å‡æ•°é‡ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
                        $("#table").click(function (e) {
                            var _this = $(e.target);
                            //åŠ 
                            if (_this.hasClass("jia")) {
                                //å¢å€¼
                                _this.prev(".number").text(+_this.prev(".number").text() + 1);
                                //ä¸ªæ•°
                                var a = _this.prev(".number").text();
                                // å•ä»·
                                var subtotal = parseFloat(_this.closest("tr").find(".unit").text());
                                _this.closest("tr").find(".subtotal").text(subtotal * a + "å…ƒ");
                                // æ€»ä»·
                                ggfun();
                            //å‡    
                            } else if (_this.hasClass("jian")) {
                                //å‡å€¼
                                _this.next(".number").text(+_this.next(".number").text() - 1);
                                if (+_this.next(".number").text() < 1) {
                                    _this.next(".number").text(1);
                                }
                                //ä¸ªæ•°
                                var a = _this.next(".number").text();
                                // å•ä»·
                                var subtotal = parseFloat(_this.closest("tr").find(".unit").text());
                                _this.closest("tr").find(".subtotal").text(subtotal * a + "å…ƒ");
                                //æ€»ä»·
                                ggfun();
                            //åˆ é™¤      
                            } else if (_this.text() === "åˆ é™¤") {
                                //è·å–åŒè¡Œtrçš„é¡ºåº
                                var index_;
                                var number_ = +_this.closest("tr").find(".sx").text();
                                JSON_obj.forEach(function (item, index) {
                                    if (+item.num > number_) {
                                        item.num = +item.num - 1;   //æ›´æ–°å†…å­˜é‡Œé¢çš„é¡ºåº
                                        $(".sx").eq(index).text(+$(".sx").eq(index).text() - 1).append(`<input type="checkbox">`);
                                    }
                                    else if (item.num === number_) {
                                        index_ = index;
                                    }
                                });
                                JSON_obj.splice(index_, 1);   //åˆ é™¤å†…å­˜å½“å‰æ•°æ®
                                //ä¼ å‡ºæ•°æ®locastorage
                                localStorage.setItem("array", JSON.stringify(JSON_obj));
                                //åˆ é™¤ä¸€è¡Œ
                                _this.closest("tr").remove();
                            //å…¨é€‰       
                            } else if (_this.is("input") && _this.parent().is("th")) {
                                var zongji = 0;
                                var input_arr = $("tbody .subtotal");

                                //inputå…¨é€‰
                                $("#table").find("input").prop("checked", _this[0].checked);
                                //æ€»è®¡
                                ggfun();
                            } else if (_this.is("input") && _this.parent().is("td")) {
                                // æ€»è®¡
                                ggfun();
                            }
                            // æ”¹æ€»è®¡
                            function ggfun() {
                                $("thead").find("input").removeAttr("checked");
                                var state = true;   //çŠ¶æ€
                                var arr = $("#tbody").find("input");
                                //åˆ¤æ–­æ‰€æœ‰
                                for (var i = 0; i < arr.length; i++) {
                                    if (!arr[i].checked) {
                                        state = false;
                                    }
                                }
                                if (state) {
                                    $("thead").find("input").prop("checked", true);
                                }
                                //æ€»è®¡
                                var zongji_ = 0;
                                for (var j = 0; j < arr.length; j++) {
                                    if (arr.eq(j).prop("checked")) {
                                        zongji_ += parseFloat(arr.eq(j).closest("tr").find(".subtotal").text());
                                    }
                                }
                                $(".agg").find("span").text(zongji_);
                            }
                        });
                    })();
                </script>
            </div>
        </div>
        <!-- é¡µè„š -->
        <div class="footer">
            <p>Copyright 2007 - 2020 vancl.com All Rights Reserved äº¬ICPè¯100557å·
                äº¬å…¬ç½‘å®‰å¤‡11011502002400å·å‡ºç‰ˆç‰©ç»è¥è®¸å¯è¯æ–°å‡ºå‘äº¬æ‰¹å­—ç¬¬ç›´110138å·</p>
        </div>
        <!-- é¡¶éƒ¨ -->
        <script>
            (function () {
                var item_li = $(".nav_ul_item");
                //è·å–æ˜¯å¦ç™»å½•
                var cookie = new Cookie();
                var token = cookie.getCookie("token");
                var maxPage = 9;
                var pageNum = 1;
                if (token) {
                    $("#login").text("ç”¨æˆ·å");
                    $("#sign").text("é€€å‡ºç™»å½•").attr("href", "./login.html");
                }
                //æœç´¢
                $("#search").click(function () {
                    if ($(".search_txt").val()) {
                        window.location.href = "./sort.html?aa=" + $(".search_txt").val();
                    } else {
                        window.location.href = "./sort.html?aa=æ›´å¤š";
                    }
                });
                //è·å–æ•°æ®
                var huodong_item = $(".huodong_item").eq(0);
                var info_val = decodeURI(location.search.split("=")[1]);
                //äºŒçº§å¯¼èˆª
                $.ajax({
                    url: "http://localhost/w/website/findGoodsTypeList",
                    type: "get",
                    dataType: "json",
                    data: {},
                    success: function (data) {
                        console.log(data);
                        data.data.forEach(function (item, index) {
                            var con = item_li.clone(true);
                            con.removeAttr("class").find("a").attr("href", "./sort.html?aa=" + item.name).text(item["name"]);
                            $(".nav_ul > li").eq($(".nav_ul > li").length - 1).before(con);
                        });
                    }
                })
            })();
        </script>
    </div>
</body>

</html>